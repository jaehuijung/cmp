<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-areas:
                'header header header'
                'chart1 chart2 chart3'
                'chart4 chart7 chart7'
                'chart6 chart7 chart7';
            grid-gap: 20px;
            padding: 20px;
        }
        .dashboard-header {
            grid-area: header;
            background-color: #e0e0e0;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            border-radius: 10px;
        }
        .dashboard-chart {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #dashboard-chart1 { grid-area: chart1; }
        #dashboard-chart2 { grid-area: chart2; }
        #dashboard-chart3 { grid-area: chart3; }
        #dashboard-chart4 { grid-area: chart4; }
        #dashboard-chart5 { grid-area: chart5; }
        #dashboard-chart6 { grid-area: chart6; }
        #dashboard-chart7 { grid-area: chart7; grid-column: span 2; }


        #clock {
            font-size: 24px; /* 글자 크기 증가 */
            font-weight: bold;
            border: 2px solid rgba(0, 0, 0, 0.2); /* 연한 색상 테두리 */
            border-radius: 10px; /* 둥근 모서리 */
            padding: 10px;
            text-align: center; /* 가운데 정렬 */
            display: inline-block;
            letter-spacing: 5px; /* 글자 간격 증가 */
        }

        #calendar {
            max-width: 100%;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <main id="main" class="dashboard">
        <div class="dashboard-grid">
            <div class="dashboard-header">Dashboard Overview</div>
            <div class="dashboard-chart" id="dashboard-chart1">
                <h4>케이블 포설 현황</h4>
                <hr>
                <div class="flex-even custom-margin-top-30">
                    <div>
                        <canvas id="chartCable"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-chart" id="dashboard-chart2">
                <h4>케이블 포설 상세현황</h4>
                <hr>
                <div class="flex-even custom-margin-top-30">
                    <div>
                        <canvas id="chartCableDetailed"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-chart flex-column-center" id="dashboard-chart3">
                <!-- 시간, 달력 ... 공간채우기용 -->
                <div id="clock"></div>
                <div id="calendar"></div>
            </div>
            <div class="dashboard-chart" id="dashboard-chart4">
                <h4>장비 등록 현황</h4>
                <hr>
                <div class="flex-even">
                    <div>
                        <canvas id="chartEquipment"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-chart" id="dashboard-chart6">
                <h4>장비누적금액</h4>
                <hr>
                <div class="flex-even">
                    <div>
                        <canvas id="chartEquipmentMoney"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-chart" id="dashboard-chart7">
                <h4>장비 등록 상세현황</h4>
                <hr>
                <canvas id="equipmentChart"></canvas>
                <br>
                <canvas id="softwareChart"></canvas>
            </div>

        </div>
    </main>

    <th:block layout:fragment="script">
        <script th:src="@{/js/main/dashboard/view.js}"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
        <script>
            /* 시간 구하는 함수 */
            function updateClock() {
                const clockElement = document.getElementById('clock');
                const now = new Date();

                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');

                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }

            // 백분율 계산 함수
            function calculatePercentage(value, total) {
                return ((value / total) * 100).toFixed(1) + '%';
            }

            $(function(){


                // 장비 등록 상세현황 데이터
                const equipmentData1 = {
                    labels: ['서버장비', '보안장비', '네트워크', '스토리지', '백업장비', '기타장비', '전산기반'],
                    datasets: [{
                        label: '장비 수',
                        data: [10903, 1024, 4195, 6657, 78, 105, 334],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)', // 바 색
                        borderColor: 'rgba(75, 192, 192, 1)', // 테두리 색
                        borderWidth: 1
                    }]
                };

                // 소프트웨어 등록 상세현황 데이터
                const softwareData1 = {
                    labels: ['시스템', '미들웨어', 'DB관리', '백업관리', '정보보호', '관제', '가상화', '응용개발'],
                    datasets: [{
                        label: '소프트웨어 수',
                        data: [193, 70, 14, 91, 17, 217, 330, 166],
                        backgroundColor: 'rgba(153, 102, 255, 0.2)', // 바 색
                        borderColor: 'rgba(153, 102, 255, 1)', // 테두리 색
                        borderWidth: 1
                    }]
                };

                // 공통 차트 옵션
                const options = {
                    plugins: {
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            color: 'rgba(0, 0, 0, 0.7)',
                            font: {
                                weight: 'bold'
                            },
                        },
                        legend: { // 라벨 제거
                            display: false
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                };

                // 장비 등록 상세현황 그래프 생성
                new Chart(document.getElementById('equipmentChart'), {
                    type: 'bar',
                    data: equipmentData1,
                    options: options,
                    plugins: [ChartDataLabels]
                });

                // 소프트웨어 등록 상세현황 그래프 생성
                new Chart(document.getElementById('softwareChart'), {
                    type: 'bar',
                    data: softwareData1,
                    options: options,
                    plugins: [ChartDataLabels]
                });




                // 매초마다 updateClock 함수 실행
                setInterval(updateClock, 1000);
                // 페이지가 로드되면 즉시 시계 업데이트
                updateClock();

                /* 케이블 포설 현황 */
                const cableData = {
                    광: 35,
                    UTF: 21,
                    TOTAL: 56
                };

                new Chart(document.getElementById('chartCable'), {
                    type: 'pie',
                    data: {
                        labels: ['광', 'UTP(Cat6)'],
                        datasets: [{
                            data: [cableData.광, cableData.UTF],
                            backgroundColor: [
                                'rgba(255, 105, 180, 0.2)',
                                'rgba(64, 224, 208, 0.4)'
                            ],
                            borderColor: [
                                'rgba(255, 105, 180, 0.3)',
                                'rgba(64, 224, 208, 0.5)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            datalabels: {
                                color: 'rgba(128, 128, 128, 0.7)', // 회색 (Grey)
                                font: { weight: 'bold', size: 22 },
                                formatter: function(value, context) { return context.chart.data.labels[context.dataIndex] + '\n' + calculatePercentage(value, cableData.TOTAL); }
                            },
                            legend: { // 라벨 제거
                                display: false
                            },
                        },
                    },
                    plugins: [ChartDataLabels] // 내부 라벨을 표시하기 위해 플러그인 추가
                });

                /* 케이블 포설 상세현황 */
                new Chart(document.getElementById('chartCableDetailed'), {
                    type: 'bar', // 막대그래프 타입 지정
                    data: {
                        labels: ['광', 'UTP'],
                        datasets: [{
                            label: '1G',
                            data: [230, 30],
                            backgroundColor: 'rgba(75, 192, 192, 0.2)', // Cyan color
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }, {
                            label: '10G',
                            data: [67, 22],
                            backgroundColor: 'rgba(153, 102, 255, 0.2)', // Purple color
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        }, {
                            label: '100G',
                            data: [14, 7],
                            backgroundColor: 'rgba(255, 159, 64, 0.2)', // Orange color
                            borderColor: 'rgba(255, 159, 64, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y', // 수평 막대그래프가 되도록 축을 전환
                        scales: {
                            x: {
                                stacked: true,
                                beginAtZero: true,
                            },
                            y: {
                                stacked: true,
                            }
                        }
                    }
                });

                /* 장비 등록 현황 */
                const equipmentData = {
                    HW: 1937,
                    SW: 123,
                    TOTAL: 2060
                };

                new Chart(document.getElementById('chartEquipment'), {
                    type: 'pie',
                    data: {
                        labels: ['HW', 'SW'],
                        datasets: [{
                            data: [equipmentData.HW, equipmentData.SW],
                            backgroundColor: [
                                'rgba(255, 206, 86, 0.4)',
                                'rgba(211, 211, 211, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255, 206, 86, 0.6)',
                                'rgba(211, 211, 211, 0.4)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            datalabels: {
                                color: 'rgba(128, 128, 128, 0.7)', // 회색 (Grey)
                                font: { weight: 'bold', size: 22 },
                                formatter: function(value, context) { return context.chart.data.labels[context.dataIndex] + '\n' + calculatePercentage(value, equipmentData.TOTAL); }
                            },
                            legend: { // 라벨 제거
                                display: false
                            },
                        },
                    },
                    plugins: [ChartDataLabels] // 내부 라벨을 표시하기 위해 플러그인 추가
                });


                /* 장비누적금액 */
                const equipmentMoneyData = {
                    HW:   1100309000,
                    SW:   337000000,
                    TOTAL:1437309000
                };

                new Chart(document.getElementById('chartEquipmentMoney'), {
                    type: 'doughnut', // 도넛 차트로 변경
                    data: {
                        labels: ['HW', 'SW'],
                        datasets: [{
                            data: [equipmentMoneyData.HW, equipmentMoneyData.SW],
                            backgroundColor: [
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(0, 0, 128, 0.2)'
                            ],
                            borderColor: [
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(0, 0, 128, 0.2)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            datalabels: {
                                color: 'rgba(128, 128, 128, 0.7)', // 회색 (Grey)
                                font: { weight: 'bold', size: 22 },
                                formatter: function(value, context) {
                                    return context.chart.data.labels[context.dataIndex] + '\n' + calculatePercentage(value, equipmentMoneyData.TOTAL);
                                }
                            },
                            legend: {
                                display: false
                            }
                        },
                    },
                    plugins: [ChartDataLabels]
                });
            });
        </script>
    </th:block>

</div>
</body>

</html>